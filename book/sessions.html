
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Capítulo 13: Las Sessions · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="cookies.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Capítulos</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Capítulo 0: Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Tutorial/Git/git.html">
            
                <a href="../Tutorial/Git/git.html">
            
                    
                    Capítulo 1: Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Tutorial/NodeJS/nodejs.html">
            
                <a href="../Tutorial/NodeJS/nodejs.html">
            
                    
                    Capítulo 2: NodeJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../Tutorial/MarkDown/markdown.html">
            
                <a href="../Tutorial/MarkDown/markdown.html">
            
                    
                    Capítulo 3: MarkDown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Tutorial/gh-pages/gh-pages.html">
            
                <a href="../Tutorial/gh-pages/gh-pages.html">
            
                    
                    Capítulo 4: GitHub Pages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../Tutorial/GitBook/gitbook.html">
            
                <a href="../Tutorial/GitBook/gitbook.html">
            
                    
                    Capítulo 5: GitBook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../Tutorial/Pandoc/pandoc.html">
            
                <a href="../Tutorial/Pandoc/pandoc.html">
            
                    
                    Capítulo 6: Pandoc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../Tutorial/Herramientas útiles/herraminetasÚtiles.html">
            
                <a href="../Tutorial/Herramientas útiles/herraminetasÚtiles.html">
            
                    
                    Capítulo 7: Herramientas útiles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../routing/BasicRouting/BasicRouting.html">
            
                <a href="../routing/BasicRouting/BasicRouting.html">
            
                    
                    Capítulo 8: Enrutamiento básico
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../routing/RoutingGuide/RoutingGuide.html">
            
                <a href="../routing/RoutingGuide/RoutingGuide.html">
            
                    
                    Capítulo 9: Guía de enrutamiento
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../routing/UsingMiddleware/UsingMiddleware.html">
            
                <a href="../routing/UsingMiddleware/UsingMiddleware.html">
            
                    
                    Capítulo 10: Los Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../routing/RouterAPIDocumentation/RouterAPIDocs.html">
            
                <a href="../routing/RouterAPIDocumentation/RouterAPIDocs.html">
            
                    
                    Capítulo 11: Documentación de la API de enrutamiento
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="cookies.html">
            
                <a href="cookies.html">
            
                    
                    Capítulo 12: Las Cookies
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.14" data-path="sessions.html">
            
                <a href="sessions.html">
            
                    
                    Capítulo 13: Las Sessions
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Capítulo 13: Las Sessions</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <hr>
<h1 id="sessions-en-expressjs">Sessions en ExpressJS</h1>
<p>En primer lugar, a modo de introducci&#xF3;n debemos de conocer brevemente los terminos de autenticaci&#xF3;n y autorizaci&#xF3;n. Autenticaci&#xF3;n es el proceso de verificar si el usuario es el mismo que el declara ser. Autorizaci&#xF3;n es el proceso de determinar si un usuario tiene los privilegios para acceder a un cierto recurso al que ha solicitado acceder. A continuaci&#xF3;n mostraremos un peque&#xF1;o fragmento de c&#xF3;digo Node.js en el que se ilustra de una manera muy simple el proceso de autenticaci&#xF3;n y autorizaci&#xF3;n mediante sesiones de express.js. Como era de esperar, hay un punto de inicio de sesi&#xF3;n, un punto de cierre de sesi&#xF3;n. Para ver la p&#xE1;gina que est&#xE1; posteada debemos autetinficarnos previamente, de esta forma nuestra identidad ser&#xE1; verificada y guardada durante la sesi&#xF3;n. Cuando cerremos la sesi&#xF3;n lo que se producir&#xE1; internamente es un borrado de nuestra identidad en dicha sesi&#xF3;n.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;express&apos;</span>),
    app = express(),
    session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;express-session&apos;</span>);
app.use(session({
    secret: <span class="hljs-string">&apos;2C44-4D44-WppQ38S&apos;</span>,
    resave: <span class="hljs-literal">true</span>,
    saveUninitialized: <span class="hljs-literal">true</span>
}));

<span class="hljs-comment">// Authentication and Authorization Middleware</span>
<span class="hljs-keyword">var</span> auth = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
  <span class="hljs-keyword">if</span> (req.session &amp;&amp; req.session.user === <span class="hljs-string">&quot;amy&quot;</span> &amp;&amp; req.session.admin)
    <span class="hljs-keyword">return</span> next();
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> res.sendStatus(<span class="hljs-number">401</span>);
};

<span class="hljs-comment">// Login endpoint</span>
app.get(<span class="hljs-string">&apos;/login&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">if</span> (!req.query.username || !req.query.password) {
    res.send(<span class="hljs-string">&apos;login failed&apos;</span>);    
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(req.query.username === <span class="hljs-string">&quot;amy&quot;</span> || req.query.password === <span class="hljs-string">&quot;amyspassword&quot;</span>) {
    req.session.user = <span class="hljs-string">&quot;amy&quot;</span>;
    req.session.admin = <span class="hljs-literal">true</span>;
    res.send(<span class="hljs-string">&quot;login success!&quot;</span>);
  }
});

<span class="hljs-comment">// Logout endpoint</span>
app.get(<span class="hljs-string">&apos;/logout&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  req.session.destroy();
  res.send(<span class="hljs-string">&quot;logout success!&quot;</span>);
});

<span class="hljs-comment">// Get content endpoint</span>
app.get(<span class="hljs-string">&apos;/content&apos;</span>, auth, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
    res.send(<span class="hljs-string">&quot;You can only see this after you&apos;ve logged in.&quot;</span>);
});

app.listen(<span class="hljs-number">3000</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;app running at http://localhost:3000&quot;</span>);
</code></pre>
<p>Este c&#xF3;digo se encuentra en la carpeta /src.</p>
<p>Para poder poner en funcionamiento el c&#xF3;digo desde la linea de comando tendrems que instalar algunas dependencias.</p>
<pre><code>npm install express
npm install express-session
node session_auth.js &amp;
</code></pre><h3 id="explicaci&#xF3;n-del-c&#xF3;digo">Explicaci&#xF3;n del c&#xF3;digo</h3>
<pre><code>var express = require(&apos;express&apos;),
    app = express(),
    session = require(&apos;express-session&apos;);
app.use(session({
    secret: &apos;2C44-4D44-WppQ38S&apos;,
    resave: true,
    saveUninitialized: true
}));
</code></pre><p>Importamos los modulos express y express-session. Creamos una aplicaci&#xF3;n express a la cual le a&#xF1;adimos nuesto middleware session.</p>
<pre><code>// Authentication and Authorization Middleware
var auth = function(req, res, next) {
  if (req.session &amp;&amp; req.session.user === &quot;amy&quot; &amp;&amp; req.session.admin)
    return next();
  else
    return res.sendStatus(401);
};
</code></pre><p>Pasamos al siguiente paso si el usuario es Amy y si ella tiene el acceso de administrado. En este caso por simplicidad y comprensi&#xF3;n del lector, hemos establecido que el usuario tiene que ser amy, en una aplicaci&#xF3;n real los datos de session ser&#xED;an comparados  con los usuarios de una base de datos de la aplicaci&#xF3;n.</p>
<pre><code>// Login endpoint
app.get(&apos;/login&apos;, function (req, res) {
  if (!req.query.username || !req.query.password) {
    res.send(&apos;login failed&apos;);    
  } else if(req.query.username === &quot;amy&quot; || req.query.password === &quot;amyspassword&quot;) {
    req.session.user = &quot;amy&quot;;
    req.session.admin = true;
    res.send(&quot;login success!&quot;);
  }
});
</code></pre><p><strong>localhost:3000/login?username=amy&amp;password=amyspassword</strong>, la URL de inicio de sesi&#xF3;n para comprobar el usuario inicie sesi&#xF3;n en guardando el nivel de acceso del usuario y usuario en una sesi&#xF3;n.</p>
<p>La sesi&#xF3;n ser&#xE1; diferente para cada usuario, y tambi&#xE9;n sera &#xFA;nica para el mismo usuario utilizando diferentes navegadores.</p>
<p>Por ejemplo, si el mismo usuario ha iniciado sesi&#xF3;n en  Chrome, y el abrir Firefox, el usuario tendr&#xE1; que volver a iniciar sesi&#xF3;n en Firefox con el fin de obtener los recursos protegidos.</p>
<p>Para fines de demostraci&#xF3;n, se trata de una petici&#xF3;n de obtenci&#xF3;n y de cruce en la informaci&#xF3;n a trav&#xE9;s de los par&#xE1;metros de consulta.</p>
<p>Una aplicaci&#xF3;n web real, por lo general se usa una solicitud posterior y pasando los datos en el formulario de env&#xED;o.</p>
<p>Una vez m&#xE1;s el usuario y las contrase&#xF1;as est&#xE1;n codificados aqu&#xED; con fines de demostraci&#xF3;n.</p>
<p>Una aplicaci&#xF3;n web real, se compruebe que el usuario y la contrase&#xF1;a de entrada contra el usuario y la contrase&#xF1;a almacenada en una base de datos de la existencia del servidor.</p>
<pre><code>// Logout endpoint
app.get(&apos;/logout&apos;, function (req, res) {
  req.session.destroy();
  res.send(&quot;logout success!&quot;);
});
</code></pre><p>hacemos el logout &apos;destruyendo&apos; la sesi&#xF3;n</p>
<pre><code>// Get content endpoint
app.get(&apos;/content&apos;, auth, function (req, res) {
    res.send(&quot;You can only see this after you&apos;ve logged in.&quot;);
});
</code></pre><p>pasamos la autenticaci&#xF3;n como segundo parametro, en caso de que la autenticaci&#xF3;n no sea valida no se llamar&#xE1;  a la callback por lo tanto esto solo funciona si estamos logueados.</p>
<hr>
<p>Existen dos formas generales de implementar sesiones en Express: utilizar cookies y utilizar un almac&#xE9;n de sesiones en el backend. Ambos a&#xF1;aden un nuevo objeto en el objeto request denominado session, que contiene las variables de sesi&#xF3;n.</p>
<p>No importa el m&#xE9;todo que utilice, Express proporciona una interfaz coherente para trabajar con los datos de la sesi&#xF3;n.</p>
<hr>
<h3 id="sesi&#xF3;n-basada-en-cookies">Sesi&#xF3;n basada en cookies</h3>
<p>Utilizando el hecho de que las cookies pueden almacenar datos en el navegador de los usuarios, se puede implementar una API de sesiones mediante cookies. Express viene con un middleware integrado llamado cookieSession, que hace precisamente eso.</p>
<p>Cargue el middleware cookieParser con un secreto, seguido por el middleware cookieSession, antes del middleware del enrutador. El middleware cookieSession depende del cookieParser middlware porque utiliza una cookie para almacenar los datos de la sesi&#xF3;n.</p>
<p>El middleware cookieParser debe inicializarse con un secreto, ya que cookieSession necesita generar una cookie HttpOnly firmada para almacenar los datos de la sesi&#xF3;n. Si no especifica un secreto para cookieParser, deber&#xE1; especificar la opci&#xF3;n secreta de cookieSsession.</p>
<p>El siguiente es el c&#xF3;digo para habilitar sesiones en Express utilizando el middleware cookieSession.</p>
<pre><code>app.use(express.cookieParser(&apos;S3CRE7&apos;));
app.use(express.cookieSession());
app.use(app.router);
</code></pre><p>Aunque el middleware cookieSession se puede inicializar sin opciones, el middleware acepta un objeto de opciones con las siguientes opciones posibles:</p>
<ul>
<li>Key: Nombre de la cookie. Por defecto connect.sess.</li>
<li>secret: contrase&#xF1;a para firmar la sesi&#xF3;n. Es requerido si CookieParser no se inicializa con uno.</li>
<li>cookie: Configuraci&#xF3;n de la cookie de sesi&#xF3;n. Se aplican los valores predeterminados de las cookies.</li>
<li>proxy: Para confiar en el proxy inverso o no. El valor predeterminado es false.</li>
</ul>
<p>A continuaci&#xF3;n un ejemplo:</p>
<pre><code>app.use(express.cookieSession({
  key: &apos;app.sess&apos;,
  secret: &apos;SUPERsekret&apos;
}));
</code></pre><hr>
<h3 id="sesi&#xF3;n-basada-en-session-store">Sesi&#xF3;n basada en Session-store</h3>
<p>Una Session-store es una provisi&#xF3;n para almacenar datos de sesi&#xF3;n en el backend. Las sesiones basadas en almacenes de sesiones pueden almacenar una gran cantidad de datos que est&#xE1;n bien ocultos al usuario.</p>
<p>El middleware de sesi&#xF3;n proporciona una forma de crear sesiones utilizando los almacenes de sesiones. Al igual que cookieSession, el middleware de sesi&#xF3;n depende del middleware cookieParser para crear una cookie HttpOnly firmada.</p>
<p>Inicializar la sesi&#xF3;n middlware es mucho como inicializar cookieSession - primero cargar cookieParser con un secreto, y cargar el middleware de la sesi&#xF3;n, antes de que el middleware del enrutador.</p>
<pre><code>app.use(express.cookieParser(&apos;S3CRE7&apos;));
app.use(express.session());
app.use(app.router);
</code></pre><p>El middleware de sesi&#xF3;n acepta un objeto de opciones que se puede utilizar para definir las opciones del middleware. Las siguientes son las opciones compatibles:</p>
<ul>
<li>Key: Nombre de la cookie. Por defecto connect.sess.</li>
<li>secret: contrase&#xF1;a para firmar la sesi&#xF3;n. Es requerido si CookieParser no se inicializa con uno.</li>
<li>cookie: Configuraci&#xF3;n de la cookie de sesi&#xF3;n. Se aplican los valores predeterminados de las cookies.</li>
<li>proxy: Para confiar en el proxy inverso o no. El valor predeterminado es false.</li>
</ul>
<p>A continuaci&#xF3;n un ejemplo:</p>
<pre><code>app.use(express.session({
  key: &apos;app.sess&apos;,
  store: new RedisStore,
  secret: &apos;SEKR37&apos;
}));
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="cookies.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Capítulo 12: Las Cookies">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Capítulo 13: Las Sessions","level":"1.14","depth":1,"previous":{"title":"Capítulo 12: Las Cookies","level":"1.13","depth":1,"path":"book/cookies.md","ref":"book/cookies.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"book/sessions.md","mtime":"2017-03-15T18:22:26.902Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-03-15T19:12:55.698Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

